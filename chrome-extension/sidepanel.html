<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>小黃標- Threads用戶所在地自動標籤</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <div class="container">

    <div class="carousel-section">
      <div class="carousel-container">
        <div class="carousel-track">
          <img src="img/guide01.webp" alt="使用指南 1" class="carousel-image active">
          <img src="img/guide02.webp" alt="使用指南 2" class="carousel-image">
          <img src="img/guide03.webp" alt="使用指南 3" class="carousel-image">
          <img src="img/guide04.webp" alt="使用指南 4" class="carousel-image">
          <img src="img/guide05.webp" alt="使用指南 5" class="carousel-image">
          <img src="img/guide06.webp" alt="使用指南 6" class="carousel-image">
        </div>
        <button class="carousel-btn carousel-btn-prev" id="carouselPrev">‹</button>
        <button class="carousel-btn carousel-btn-next" id="carouselNext">›</button>
      </div>
      <div class="carousel-indicators" style="display: none">
        <span class="carousel-indicator active" data-index="0"></span>
        <span class="carousel-indicator" data-index="1"></span>
        <span class="carousel-indicator" data-index="2"></span>
        <span class="carousel-indicator" data-index="3"></span>
        <span class="carousel-indicator" data-index="4"></span>
        <span class="carousel-indicator" data-index="5"></span>
      </div>
      <div class="carousel-credit">
        <span>圖卡 Credit </span>
        <a href="https://www.threads.com/@chibc_" target="_blank" rel="noopener noreferrer" class="credit-link">
          <span class="credit-icon">@</span>
          <span class="credit-name">暗月之鏡 chibc_</span>
        </a>
      </div>
    </div>

    <div class="welcome-section">
      <p class="welcome-intro"><strong>小黃標</strong>｜分析公開資料，守護真實對話</p>
      <p class="welcome-desc">快速查詢 Threads 用戶所在地，AI 分析發言紀錄評估帳號可信度。針對情緒攻擊、詐騙或仇恨內容，自動降低顯示優先度。</p>
      <p class="welcome-tip">開啟此面板顯示<span class="location-tag">標籤</span>，按 <svg class="sidepanel-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="1" y="2" width="14" height="12" rx="1" fill="none" stroke="currentColor" stroke-width="1.5"/><line x1="11" y1="2" x2="11" y2="14" stroke="currentColor" stroke-width="1.5"/><polygon points="4,5 4,11 7,8" fill="currentColor"/></svg> 關閉即隱藏。</p>
    </div>

    <div id="statusBar" class="status-bar">就緒</div>

    <div class="cache-stats-display">
      <div class="cache-stats-info">
        <div class="cache-stat-item">
          <span class="cache-stat-label">所在地</span>
          <strong id="cacheCount" class="cache-count-clickable" title="點擊刷新統計">0</strong>
        </div>
        <div class="cache-stat-item">
          <span class="cache-stat-label">用戶側寫</span>
          <strong id="profileCacheCount" class="cache-count-clickable" title="點擊刷新統計">0</strong>
        </div>
        <div class="cache-stat-item">
          <span class="cache-stat-label">手動標注</span>
          <strong id="trustListCount" class="cache-count-clickable" title="點擊刷新統計">0</strong>
        </div>
      </div>
      <div class="cache-action-buttons">
        <button id="clearAllCacheBtn" class="clear-cache-btn" title="清除所有本機保存的快取資料">清除</button>
        <button id="exportCacheBtn" class="export-cache-btn" title="匯出快取資料">匯出</button>
      </div>
    </div>

    <details class="advanced-section" id="advancedSection">
      <summary class="advanced-toggle">進階設定...</summary>
      <div class="advanced-content">
        <div class="control-group">
          <label class="checkbox-container">
            <input type="checkbox" id="autoQueryModeCheckbox">
            <span class="checkbox-label">智慧自動查詢</span>
          </label>
          <p class="option-description">預先針對高互動陌生帳號自動做查詢</p>
          <div class="sub-option" id="maxConcurrentContainer" style="display: none;">
            <label for="maxConcurrentInput">同時最多查詢分頁數量：</label>
            <input type="number" id="maxConcurrentInput" min="1" max="10" value="3" style="width: 60px;">
          </div>
        </div>

        <div class="control-group">
          <label class="checkbox-container">
            <input type="checkbox" id="llmProfileAnalysisCheckbox">
            <span class="checkbox-label">帳號行為分析</span>
          </label>
          <p class="option-description">根據用戶近期的貼文與回覆內容，使用AI產生行為側寫標籤。</p>
          <div class="llm-provider-section" id="llmProviderSection" style="display: none;">
            <div class="llm-provider-options">
              <label for="llmProviderSelect">模型：</label>
              <select id="llmProviderSelect" name="llmProvider">
                <option value="local">🆓 本機 Gemini-3-nano</option>
                <option value="openrouter">🆓💰 雲端 OpenRouter</option>
                <option value="openai">💰 雲端 gpt-5-mini</option>
                <option value="claude">💰 雲端 claude-haiku-4.5</option>
              </select>
            </div>
            <div class="llm-config-panel" id="openaiConfigPanel">
              <div class="config-row">
                <label for="openaiApiKeyInput">OpenAI API Key：</label>
                <span id="apiKeySetIndicator" style="display: none;">
                  <span class="api-key-set-text">已設定</span>
                  <button type="button" id="editApiKeyBtn" class="small-text-btn">[edit]</button>
                </span>
                <span id="apiKeyInputContainer">
                  <input type="password" id="openaiApiKeyInput" placeholder="sk-..." style="width: 160px;">
                  <button type="button" id="clearApiKeyBtn" class="small-text-btn">[clear]</button>
                </span>
                <span id="apiKeyStatus" class="api-key-status"></span>
              </div>
            </div>
            <div class="llm-config-panel" id="claudeConfigPanel" style="display: none;">
              <div class="config-row">
                <label for="claudeApiKeyInput">Claude API Key：</label>
                <span id="claudeApiKeySetIndicator" style="display: none;">
                  <span class="api-key-set-text">已設定</span>
                  <button type="button" id="editClaudeApiKeyBtn" class="small-text-btn">[edit]</button>
                </span>
                <span id="claudeApiKeyInputContainer">
                  <input type="password" id="claudeApiKeyInput" placeholder="sk-ant-..." style="width: 160px;">
                  <button type="button" id="clearClaudeApiKeyBtn" class="small-text-btn">[clear]</button>
                </span>
                <span id="claudeApiKeyStatus" class="api-key-status"></span>
              </div>
            </div>
            <div class="llm-config-panel" id="openrouterConfigPanel" style="display: none;">
              <div class="config-row">
                <label for="openrouterApiKeyInput">OpenRouter API Key：</label>
                <span id="openrouterApiKeySetIndicator" style="display: none;">
                  <span class="api-key-set-text">已設定</span>
                  <button type="button" id="editOpenrouterApiKeyBtn" class="small-text-btn">[edit]</button>
                </span>
                <span id="openrouterApiKeyInputContainer">
                  <input type="password" id="openrouterApiKeyInput" placeholder="sk-or-v1-..." style="width: 160px;">
                  <button type="button" id="clearOpenrouterApiKeyBtn" class="small-text-btn">[clear]</button>
                </span>
                <span id="openrouterApiKeyStatus" class="api-key-status"></span>
              </div>
              <div class="config-row">
                <label for="openrouterModelInput">Model</label>
                <input type="text" id="openrouterModelInput" placeholder="openrouter/free" style="width: 280px;">
                <span id="openrouterModelStatus" class="api-key-status"></span>
              </div>
            </div>
            <div class="llm-config-panel" id="localLLMConfigPanel" style="display: none;">
              <div id="localLLMStatus" class="local-llm-status checking">檢查中...</div>
            </div>
          </div>
        </div>
        

        <div class="control-group">
          <label class="checkbox-container">
            <input type="checkbox" id="keepTabCheckbox">
            <span class="checkbox-label">查詢後保留結果分頁</span>
          </label>
          <p class="option-description">此選項開啟時，會保留所開啟的查詢結果分頁，可供查看查詢結果，以及該用戶其他資訊。</p>
          <div class="sub-option" id="keepTabFilterContainer" style="display: none;">
            <label for="keepTabFilterInput">僅保留結果不符合：</label>
            <input type="text" id="keepTabFilterInput" value="Taiwan" style="width: 120px;">
          </div>
        </div>
        
        <!--
        <div class="user-count-display">
          <span id="userCountLabel">已顯示標籤: <strong id="userCount">0</strong></span>
          <button id="manualDetectBtn" class="manual-detect-btn" title="手動加入標籤">手動加入標籤</button>
          <span id="progressLabel" style="display: none;"> | 查詢進度: <strong id="queryProgress">0/0</strong></span>
        </div>
         -->

        <div class="content-group">
          <label for="contentOutput">查詢結果:</label>
          <textarea id="contentOutput" rows="5" readonly placeholder="查詢結果將顯示在這裡..."></textarea>
        </div>
      </div>
    </details>

    <div class="version-info">v0.9.11</div>

  </div>

  <script type="module" src="sidepanel-loader.js"></script>
</body>
</html>
